<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>hello-wasm example</title>
  </head>
  <body>
    <canvas id="canvas" width="800" height="450" style="image-rendering: pixelated;"></canvas>
    <script type="module">
      import init, { context_create, context_render, context_get_state } from "./pkg/logo_img_render.js";
      init().then(() => {
        const canvas = document.getElementById("canvas");

        let context = context_create(canvas.width, canvas.height);
        let renderData;
        try {
          renderData = context_render(context, "to square :x repeat 3 [fd :x rt 90] end", "square 30 square 40 square 50");
        }
        catch(e) {
          alert(e);
        }
        let state = context_get_state(context);
        console.log(state.turtle_pos.x);
        
        const ctx = canvas.getContext("2d");
        const imageData = ctx.createImageData(canvas.width, canvas.height);
        for (let i = 0; i < imageData.data.length; i += 4) {
          imageData.data[i] = renderData[i+2];
          imageData.data[i+1] = renderData[i+1];
          imageData.data[i+2] = renderData[i];
          imageData.data[i+3] = renderData[i+3];
        }
        ctx.putImageData(imageData, 0, 0);
      });
    </script>
  </body>
</html>
